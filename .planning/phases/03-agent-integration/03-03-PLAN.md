---
phase: 03-agent-integration
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/AgentOutput.tsx
  - src/components/AgentControls.tsx
autonomous: true

must_haves:
  truths:
    - "User can see agent output in real-time"
    - "User can stop a running agent"
    - "User can restart a stopped agent"
  artifacts:
    - path: "src/components/AgentOutput.tsx"
      provides: "Streaming output display using Ink Static"
      exports: ["AgentOutput"]
    - path: "src/components/AgentControls.tsx"
      provides: "Start/stop/restart controls"
      exports: ["AgentControls"]
  key_links:
    - from: "src/components/AgentOutput.tsx"
      to: "ink"
      via: "Static component import"
      pattern: "import.*Static.*from.*ink"
    - from: "src/components/AgentControls.tsx"
      to: "src/agents/spawn.ts"
      via: "stopAgent, restartAgent imports"
      pattern: "import.*stopAgent.*restartAgent.*from.*spawn"
---

<objective>
Create React components for displaying agent output and controlling agent lifecycle (stop/restart).

Purpose: These components provide the user interface for interacting with agents in workspaces.
Output: AgentOutput.tsx for streaming display, AgentControls.tsx for stop/restart buttons
</objective>

<execution_context>
@/Users/nazim.saouli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nazim.saouli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-agent-integration/03-RESEARCH.md

# Agent types from Plan 01
@src/agents/types.ts
@src/agents/spawn.ts

# Existing UI patterns
@src/components/Settings.tsx
@src/components/WorkspaceList.tsx
@src/app.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AgentOutput component</name>
  <files>src/components/AgentOutput.tsx</files>
  <action>
Create src/components/AgentOutput.tsx for streaming agent output display:

1. Import from ink: Box, Text, Static
2. Import React

3. Props interface:
   ```typescript
   interface AgentOutputProps {
     outputLines: string[];      // Array of output lines to display
     maxVisibleLines?: number;   // Max lines to show (default: 20 most recent)
     showTimestamps?: boolean;   // Whether to show timestamps (default: false)
   }
   ```

4. AgentOutput component:
   - Use Ink's Static component for append-only output (prevents re-render flicker)
   - Static is for output that doesn't change once rendered
   - Show most recent maxVisibleLines lines
   - Each line gets a unique key (use index since lines are append-only)

   ```tsx
   export function AgentOutput({ outputLines, maxVisibleLines = 20 }: AgentOutputProps) {
     // Get most recent lines
     const visibleLines = outputLines.slice(-maxVisibleLines);

     return (
       <Box flexDirection="column" borderStyle="single" borderColor="gray" padding={1}>
         <Box marginBottom={1}>
           <Text bold color="cyan">Agent Output</Text>
           <Text color="gray"> ({outputLines.length} lines)</Text>
         </Box>

         {visibleLines.length === 0 ? (
           <Text color="gray">Waiting for output...</Text>
         ) : (
           <Static items={visibleLines}>
             {(line, index) => (
               <Text key={index} wrap="truncate">{line}</Text>
             )}
           </Static>
         )}
       </Box>
     );
   }
   ```

5. Note on Static component:
   - Static renders items permanently (append-only)
   - Items are NOT re-rendered when the array changes
   - New items are appended to the output
   - Perfect for logs/streaming output

6. Export AgentOutput component
  </action>
  <verify>npx tsc --noEmit (no type errors)</verify>
  <done>AgentOutput.tsx renders streaming output using Ink's Static component</done>
</task>

<task type="auto">
  <name>Task 2: Create AgentControls component</name>
  <files>src/components/AgentControls.tsx</files>
  <action>
Create src/components/AgentControls.tsx for agent lifecycle controls:

1. Import from ink: Box, Text, useInput
2. Import React, useState
3. Import agent functions: stopAgent, restartAgent from '../agents/spawn.js'
4. Import AgentStatus type from '../state/agents.js' (or define locally if Plan 02 not complete)

5. Props interface:
   ```typescript
   interface AgentControlsProps {
     agentId: string | null;           // Current agent ID (null if no agent)
     status: 'idle' | 'running' | 'stopped' | 'error';
     workspaceId: string;
     workspacePath: string;
     agentType: 'claude' | 'opencode';
     onStart: () => void;              // Callback when user wants to start agent
     onStop: () => void;               // Callback when stop completes
     onRestart: () => void;            // Callback when restart completes
     onError: (error: Error) => void;  // Callback on error
   }
   ```

6. AgentControls component:
   - Display current status with appropriate color:
     - idle: gray
     - running: green
     - stopped: yellow
     - error: red

   - Show keyboard shortcuts based on status:
     - idle: "s: start agent"
     - running: "x: stop agent"
     - stopped: "r: restart agent | s: start agent"
     - error: "r: retry | s: start fresh"

   - Handle keyboard input with useInput:
     - 's' when idle/stopped/error: call onStart
     - 'x' when running: call handleStop (then onStop)
     - 'r' when stopped/error: call handleRestart (then onRestart)

   - handleStop function:
     ```typescript
     const handleStop = async () => {
       if (!agentId) return;
       setIsLoading(true);
       try {
         await stopAgent(agentId);
         onStop();
       } catch (err) {
         onError(err instanceof Error ? err : new Error(String(err)));
       } finally {
         setIsLoading(false);
       }
     };
     ```

   - handleRestart function:
     ```typescript
     const handleRestart = async () => {
       if (!agentId) return;
       setIsLoading(true);
       try {
         // restartAgent handles stop + spawn internally
         // But we need to wire up events - caller will handle this
         onRestart();
       } catch (err) {
         onError(err instanceof Error ? err : new Error(String(err)));
       } finally {
         setIsLoading(false);
       }
     };
     ```

   - Show loading state during operations

7. Component layout:
   ```tsx
   return (
     <Box flexDirection="column">
       <Box>
         <Text>Status: </Text>
         <Text color={statusColor}>{status}</Text>
         {isLoading && <Text color="yellow"> (working...)</Text>}
       </Box>
       <Box marginTop={1}>
         <Text color="gray">{getShortcutHint(status)}</Text>
       </Box>
     </Box>
   );
   ```

8. Export AgentControls component
  </action>
  <verify>npx tsc --noEmit (no type errors)</verify>
  <done>AgentControls.tsx provides stop/restart controls with keyboard shortcuts</done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. Components follow existing patterns: Check similar structure to Settings.tsx, WorkspaceList.tsx
3. Ink imports are correct: Static from 'ink', not from 'ink/build/components/Static'
</verification>

<success_criteria>
- AgentOutput.tsx uses Ink's Static component for append-only output display
- AgentControls.tsx provides stop/restart with keyboard shortcuts
- Components follow existing codebase patterns (TypeScript, functional components, Ink)
- Status display uses appropriate colors for each state
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-agent-integration/03-03-SUMMARY.md`
</output>
