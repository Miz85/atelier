---
phase: 04-ui-navigation
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/ThreePaneLayout.tsx
  - src/components/AgentPane.tsx
  - src/components/DiffSummaryPane.tsx
  - src/components/TerminalPane.tsx
  - src/app.tsx
autonomous: true

must_haves:
  truths:
    - "App displays three horizontal panes when viewing workspace"
    - "User can Tab between panes"
    - "Focused pane has distinct visual indicator (double border, cyan color)"
    - "Pressing ? opens help screen"
    - "Pane keyboard shortcuts only work when that pane is focused"
  artifacts:
    - path: "src/components/ThreePaneLayout.tsx"
      provides: "Three-pane container with focus management"
      exports: ["ThreePaneLayout"]
    - path: "src/components/AgentPane.tsx"
      provides: "Agent output and controls pane"
      exports: ["AgentPane"]
    - path: "src/components/DiffSummaryPane.tsx"
      provides: "Placeholder diff summary pane"
      exports: ["DiffSummaryPane"]
    - path: "src/components/TerminalPane.tsx"
      provides: "Placeholder terminal pane"
      exports: ["TerminalPane"]
    - path: "src/app.tsx"
      provides: "App integration with three-pane layout"
      contains: "ThreePaneLayout"
  key_links:
    - from: "src/components/ThreePaneLayout.tsx"
      to: "src/state/ui.ts"
      via: "useAtom(showHelpAtom)"
      pattern: "useAtom.*showHelpAtom"
    - from: "src/components/AgentPane.tsx"
      to: "src/agents/spawn.ts"
      via: "agent operations import"
      pattern: "import.*from.*agents/spawn"
    - from: "src/app.tsx"
      to: "src/components/ThreePaneLayout.tsx"
      via: "component import and render"
      pattern: "<ThreePaneLayout"
---

<objective>
Create the three-pane layout with Tab navigation and integrate into the app.

Purpose: Implement the main UI layout (UI-01) with keyboard navigation between panes (UI-02) and help screen toggle (UI-03). This transforms the app from screen-based navigation to pane-based navigation when viewing a workspace.

Output: ThreePaneLayout component with three focusable panes, AgentPane (functional), DiffSummaryPane and TerminalPane (placeholders for Phase 5), and updated app.tsx integration.
</objective>

<execution_context>
@/Users/nazim.saouli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nazim.saouli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ui-navigation/04-RESEARCH.md
@.planning/phases/04-ui-navigation/04-01-SUMMARY.md

# Existing code to integrate with
@src/app.tsx
@src/components/AgentView.tsx
@src/state/ui.ts
@src/components/HelpScreen.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pane components and ThreePaneLayout</name>
  <files>
    src/components/ThreePaneLayout.tsx
    src/components/AgentPane.tsx
    src/components/DiffSummaryPane.tsx
    src/components/TerminalPane.tsx
  </files>
  <action>
Create the three-pane layout system following 04-RESEARCH.md patterns:

**1. Create src/components/AgentPane.tsx:**
- Adapt functionality from AgentView.tsx into a focusable pane
- Use `useFocus({ id: 'agent-pane' })` for focus management
- Use `useInput` with `isActive: isFocused && !showHelp && !attaching`
- Keep all agent control logic (start/stop/restart/attach)
- Keep output preview display
- Visual: double border when focused (cyan), single border otherwise (gray)
- Accepts `workspace: Workspace` prop

**2. Create src/components/DiffSummaryPane.tsx:**
- Placeholder pane for Phase 5 (GIT-01 diff viewing)
- Use `useFocus({ id: 'diff-pane' })` for focus management
- Display "Diff Summary" title and "Coming in Phase 5" placeholder text
- Visual: double border when focused (cyan), single border otherwise (gray)
- No keyboard handlers needed yet (placeholder)

**3. Create src/components/TerminalPane.tsx:**
- Placeholder pane for Phase 5 (terminal integration)
- Use `useFocus({ id: 'terminal-pane' })` for focus management
- Display "Terminal" title and "Coming in Phase 5" placeholder text
- Visual: double border when focused (cyan), single border otherwise (gray)
- No keyboard handlers needed yet (placeholder)

**4. Create src/components/ThreePaneLayout.tsx:**
- Container component using Box with flexDirection="row"
- Renders AgentPane (40%), DiffSummaryPane (40%), TerminalPane (20%)
- Handles global keyboard input for ? (toggle help)
- Conditional render of HelpScreen overlay when showHelp is true
- Accepts `workspace: Workspace` and `onBack: () => void` props
- Uses `useInput` with `isActive: !showHelp` for global shortcuts

Key patterns from research:
- useFocus for Tab navigation (Ink handles Tab/Shift+Tab automatically)
- useInput with isActive to prevent input conflicts
- showHelpAtom controls modal visibility AND disables pane input
- Box percentages for responsive layout (40/40/20)

CRITICAL: When help is showing, ALL pane useInput hooks must have `isActive: false` to prevent background input handling.
  </action>
  <verify>
1. All files exist:
```bash
ls -la src/components/ThreePaneLayout.tsx src/components/AgentPane.tsx src/components/DiffSummaryPane.tsx src/components/TerminalPane.tsx
```

2. TypeScript compiles:
```bash
npm run build
```

3. Components export correctly:
```bash
grep "export" src/components/ThreePaneLayout.tsx src/components/AgentPane.tsx src/components/DiffSummaryPane.tsx src/components/TerminalPane.tsx
```
  </verify>
  <done>
- ThreePaneLayout renders three horizontal panes
- AgentPane has full agent control functionality
- DiffSummaryPane and TerminalPane are placeholders
- Tab navigation works via useFocus hooks
- ? key toggles help screen
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ThreePaneLayout into app.tsx</name>
  <files>src/app.tsx</files>
  <action>
Update app.tsx to use ThreePaneLayout instead of AgentView when viewing a workspace:

1. Import ThreePaneLayout component
2. Replace the 'agent-view' screen case with 'workspace-view' that renders ThreePaneLayout
3. Update the 'a' keyboard shortcut to navigate to 'workspace-view' instead of 'agent-view'
4. Pass workspace and onBack props to ThreePaneLayout
5. Keep existing screen navigation for settings, create-workspace, workspace-list

The main screen shortcuts remain:
- n: create workspace
- w: list workspaces
- s: settings
- a: workspace view (now three-pane layout)
- q: quit

IMPORTANT: Do NOT remove AgentView.tsx - it may still be useful as a reference. Just stop using it in app.tsx.

After this change:
- Pressing 'a' when activeWorkspace exists shows ThreePaneLayout
- Tab cycles through agent-pane, diff-pane, terminal-pane
- ? shows help screen overlay
- q or Esc from ThreePaneLayout goes back to main
  </action>
  <verify>
1. app.tsx compiles:
```bash
npm run build
```

2. ThreePaneLayout is imported and used:
```bash
grep -n "ThreePaneLayout" src/app.tsx
```

3. App runs without errors:
```bash
timeout 3 npm start 2>&1 || true
```
  </verify>
  <done>
- app.tsx uses ThreePaneLayout for workspace view
- 'a' shortcut opens three-pane layout
- Existing navigation preserved for other screens
  </done>
</task>

</tasks>

<verification>
1. Build succeeds:
```bash
npm run build
```

2. All new components exist:
```bash
ls -la src/components/ThreePaneLayout.tsx src/components/AgentPane.tsx src/components/DiffSummaryPane.tsx src/components/TerminalPane.tsx
```

3. App can start:
```bash
timeout 3 npm start 2>&1 | head -20 || true
```

4. ThreePaneLayout integrated:
```bash
grep "ThreePaneLayout" src/app.tsx
```
</verification>

<success_criteria>
- ThreePaneLayout renders three horizontal panes
- AgentPane has all agent control functionality (start/stop/restart/attach)
- DiffSummaryPane and TerminalPane render as placeholders
- Tab key cycles focus between panes (via Ink's useFocus)
- Focused pane has double cyan border, unfocused panes have single gray border
- ? key opens HelpScreen modal overlay
- Keyboard shortcuts in panes only work when that pane is focused
- Background panes ignore input when HelpScreen is showing
- app.tsx uses ThreePaneLayout when user presses 'a'
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-navigation/04-02-SUMMARY.md`
</output>
