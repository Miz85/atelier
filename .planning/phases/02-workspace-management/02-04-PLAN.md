---
phase: 02-workspace-management
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - src/components/CreateWorkspace.tsx
  - src/components/WorkspaceList.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter branch name and create workspace"
    - "User can see list of workspaces with branch info"
    - "User can select workspace from list"
    - "User can delete workspace from list"
  artifacts:
    - path: "src/components/CreateWorkspace.tsx"
      provides: "Workspace creation form"
      exports: ["CreateWorkspace"]
    - path: "src/components/WorkspaceList.tsx"
      provides: "Workspace list with selection"
      exports: ["WorkspaceList"]
  key_links:
    - from: "src/components/CreateWorkspace.tsx"
      to: "src/workspace/workspace-manager.ts"
      via: "createWorkspace call"
      pattern: "createWorkspace"
    - from: "src/components/WorkspaceList.tsx"
      to: "src/state/workspace.ts"
      via: "Jotai atoms"
      pattern: "useAtom.*workspacesAtom"
---

<objective>
Create workspace UI components for creating and listing workspaces.

Purpose: Users need visual interface to create workspaces (enter branch name) and browse/select/delete existing workspaces.

Output: CreateWorkspace.tsx and WorkspaceList.tsx Ink components
</objective>

<execution_context>
@/Users/nazim.saouli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nazim.saouli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-04-SUMMARY.md
@.planning/phases/02-workspace-management/02-02-SUMMARY.md
@.planning/phases/02-workspace-management/02-03-SUMMARY.md
@src/components/Settings.tsx
@src/state/workspace.ts
@src/workspace/workspace-manager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CreateWorkspace.tsx component</name>
  <files>src/components/CreateWorkspace.tsx</files>
  <action>
Create `src/components/CreateWorkspace.tsx` following Settings.tsx patterns:

```typescript
import React, { useState } from 'react';
import { Box, Text, useInput } from 'ink';
import TextInput from 'ink-text-input';
import { useAtom } from 'jotai';
import { workspacesAtom, repoPathAtom, activeWorkspaceIdAtom } from '../state/workspace.js';
import { settingsAtom } from '../state/settings.js';
import { createWorkspace } from '../workspace/workspace-manager.js';

interface CreateWorkspaceProps {
  onBack: () => void;
  onCreated?: (workspaceId: string) => void;
}

export function CreateWorkspace({ onBack, onCreated }: CreateWorkspaceProps) {
  const [workspaces, setWorkspaces] = useAtom(workspacesAtom);
  const [repoPath, setRepoPath] = useAtom(repoPathAtom);
  const [, setActiveWorkspaceId] = useAtom(activeWorkspaceIdAtom);
  const [settings] = useAtom(settingsAtom);

  // Form state
  const [step, setStep] = useState<'repo' | 'branch' | 'creating' | 'error'>('repo');
  const [repoInput, setRepoInput] = useState(repoPath || '');
  const [branchInput, setBranchInput] = useState('');
  const [error, setError] = useState<string | null>(null);

  // Skip repo step if already set
  React.useEffect(() => {
    if (repoPath && step === 'repo') {
      setStep('branch');
    }
  }, [repoPath, step]);

  useInput((input, key) => {
    // Escape to go back
    if (key.escape) {
      onBack();
      return;
    }
  });

  const handleRepoSubmit = (value: string) => {
    const trimmed = value.trim();
    if (!trimmed) {
      setError('Repository path is required');
      setStep('error');
      return;
    }
    setRepoPath(trimmed);
    setStep('branch');
  };

  const handleBranchSubmit = async (value: string) => {
    const trimmed = value.trim();
    if (!trimmed) {
      setError('Branch name is required');
      setStep('error');
      return;
    }

    setStep('creating');

    try {
      const workspace = await createWorkspace({
        repoPath: repoPath!,
        branchName: trimmed,
        agent: settings.defaultAgent,
      });

      // Add to state
      setWorkspaces([...workspaces, workspace]);

      // Set as active
      setActiveWorkspaceId(workspace.id);

      // Notify parent
      onCreated?.(workspace.id);
      onBack();
    } catch (err) {
      setError(err instanceof Error ? err.message : String(err));
      setStep('error');
    }
  };

  return (
    <Box flexDirection="column" padding={1}>
      <Box marginBottom={1}>
        <Text bold color="cyan">Create Workspace</Text>
      </Box>

      {step === 'repo' && (
        <Box flexDirection="column">
          <Text>Repository path:</Text>
          <Box>
            <TextInput
              value={repoInput}
              onChange={setRepoInput}
              onSubmit={handleRepoSubmit}
              placeholder="/path/to/your/repo"
            />
          </Box>
          <Text color="gray" dimColor>
            Enter the path to your git repository
          </Text>
        </Box>
      )}

      {step === 'branch' && (
        <Box flexDirection="column">
          <Text color="gray">Repository: {repoPath}</Text>
          <Box marginTop={1}>
            <Text>Branch name:</Text>
          </Box>
          <Box>
            <TextInput
              value={branchInput}
              onChange={setBranchInput}
              onSubmit={handleBranchSubmit}
              placeholder="feature/my-feature"
            />
          </Box>
          <Text color="gray" dimColor>
            A new branch and worktree will be created
          </Text>
        </Box>
      )}

      {step === 'creating' && (
        <Box>
          <Text color="yellow">Creating workspace...</Text>
        </Box>
      )}

      {step === 'error' && (
        <Box flexDirection="column">
          <Text color="red">Error: {error}</Text>
          <Box marginTop={1}>
            <Text color="gray">Press Esc to go back</Text>
          </Box>
        </Box>
      )}

      <Box marginTop={2}>
        <Text color="gray">Esc: back</Text>
      </Box>
    </Box>
  );
}
```

Key patterns:
- Multi-step form (repo path -> branch name -> creating)
- Uses ink-text-input for text entry
- Integrates with workspace-manager createWorkspace
- Updates Jotai state after creation
- Sets new workspace as active
- Error handling with user feedback
  </action>
  <verify>
`npm run build` succeeds with no TypeScript errors.
File exists at `src/components/CreateWorkspace.tsx`.
  </verify>
  <done>
CreateWorkspace.tsx provides:
- Multi-step form for workspace creation
- Repository path entry (persisted for future use)
- Branch name entry
- Integration with createWorkspace manager
- State updates via Jotai atoms
- Error display and recovery
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WorkspaceList.tsx component</name>
  <files>src/components/WorkspaceList.tsx</files>
  <action>
Create `src/components/WorkspaceList.tsx` with keyboard navigation:

```typescript
import React, { useState } from 'react';
import { Box, Text, useInput } from 'ink';
import { useAtom } from 'jotai';
import {
  workspacesAtom,
  activeWorkspaceIdAtom,
  repoPathAtom,
  type Workspace
} from '../state/workspace.js';
import { deleteWorkspace } from '../workspace/workspace-manager.js';

interface WorkspaceListProps {
  onBack: () => void;
  onSelect?: (workspace: Workspace) => void;
}

export function WorkspaceList({ onBack, onSelect }: WorkspaceListProps) {
  const [workspaces, setWorkspaces] = useAtom(workspacesAtom);
  const [activeId, setActiveId] = useAtom(activeWorkspaceIdAtom);
  const [repoPath] = useAtom(repoPathAtom);

  const [selectedIndex, setSelectedIndex] = useState(0);
  const [deleting, setDeleting] = useState<string | null>(null);
  const [confirmDelete, setConfirmDelete] = useState(false);

  useInput((input, key) => {
    if (deleting) return; // Ignore input while deleting

    // Navigation
    if (input === 'j' || key.downArrow) {
      setSelectedIndex(i => Math.min(i + 1, workspaces.length - 1));
      setConfirmDelete(false);
    }
    if (input === 'k' || key.upArrow) {
      setSelectedIndex(i => Math.max(i - 1, 0));
      setConfirmDelete(false);
    }

    // Select/activate workspace
    if (key.return && workspaces.length > 0) {
      const workspace = workspaces[selectedIndex];
      setActiveId(workspace.id);
      onSelect?.(workspace);
    }

    // Delete workspace
    if (input === 'd' && workspaces.length > 0) {
      if (confirmDelete) {
        // Second press - actually delete
        handleDelete(workspaces[selectedIndex]);
      } else {
        // First press - ask for confirmation
        setConfirmDelete(true);
      }
    }

    // Cancel delete confirmation on any other key
    if (input !== 'd') {
      setConfirmDelete(false);
    }

    // Escape to go back
    if (key.escape) {
      onBack();
    }
  });

  const handleDelete = async (workspace: Workspace) => {
    if (!repoPath) {
      console.error('No repo path set');
      return;
    }

    setDeleting(workspace.id);
    setConfirmDelete(false);

    try {
      await deleteWorkspace(workspace, repoPath);

      // Remove from state
      const newWorkspaces = workspaces.filter(w => w.id !== workspace.id);
      setWorkspaces(newWorkspaces);

      // If deleted workspace was active, clear active
      if (activeId === workspace.id) {
        setActiveId(newWorkspaces.length > 0 ? newWorkspaces[0].id : null);
      }

      // Adjust selection index
      setSelectedIndex(i => Math.min(i, newWorkspaces.length - 1));
    } catch (err) {
      console.error('Failed to delete workspace:', err);
    } finally {
      setDeleting(null);
    }
  };

  return (
    <Box flexDirection="column" padding={1}>
      <Box marginBottom={1}>
        <Text bold color="cyan">Workspaces</Text>
        <Text color="gray"> ({workspaces.length})</Text>
      </Box>

      {workspaces.length === 0 ? (
        <Box marginBottom={1}>
          <Text color="yellow">No workspaces. Press 'n' on main screen to create one.</Text>
        </Box>
      ) : (
        <Box flexDirection="column" marginBottom={1}>
          {workspaces.map((ws, index) => {
            const isSelected = index === selectedIndex;
            const isActive = ws.id === activeId;
            const isDeleting = ws.id === deleting;

            return (
              <Box key={ws.id}>
                <Text color={isSelected ? 'cyan' : undefined}>
                  {isSelected ? '> ' : '  '}
                </Text>
                <Text
                  color={isDeleting ? 'red' : isActive ? 'green' : undefined}
                  dimColor={isDeleting}
                >
                  {ws.name}
                </Text>
                <Text color="gray"> ({ws.branch})</Text>
                <Text color="gray" dimColor> [{ws.agent}]</Text>
                {isActive && <Text color="green"> *</Text>}
                {isDeleting && <Text color="red"> deleting...</Text>}
                {isSelected && confirmDelete && !isDeleting && (
                  <Text color="red"> Press 'd' again to delete</Text>
                )}
              </Box>
            );
          })}
        </Box>
      )}

      <Box marginTop={1} flexDirection="column">
        <Text color="gray">j/k: navigate | Enter: select | d: delete | Esc: back</Text>
        {activeId && (
          <Text color="gray" dimColor>* = active workspace</Text>
        )}
      </Box>
    </Box>
  );
}
```

Key patterns:
- Keyboard navigation (j/k or arrows)
- Selection highlighting
- Active workspace indicator (*)
- Delete with confirmation (press 'd' twice)
- Integration with workspace-manager deleteWorkspace
- State updates via Jotai atoms
  </action>
  <verify>
`npm run build` succeeds with no TypeScript errors.
File exists at `src/components/WorkspaceList.tsx`.
  </verify>
  <done>
WorkspaceList.tsx provides:
- List display with workspace name, branch, agent type
- Keyboard navigation (j/k/arrows)
- Selection highlighting
- Active workspace indicator
- Delete with confirmation
- Integration with deleteWorkspace manager
- State updates via Jotai atoms
  </done>
</task>

</tasks>

<verification>
1. `npm run build` compiles without errors
2. Both components exist and export properly
3. Components use established patterns from Settings.tsx
</verification>

<success_criteria>
- CreateWorkspace provides form to enter repo path and branch name
- WorkspaceList displays workspaces with navigation and selection
- Both components integrate with Jotai state atoms
- Delete operation uses workspace-manager and updates state
</success_criteria>

<output>
After completion, create `.planning/phases/02-workspace-management/02-04-SUMMARY.md`
</output>
