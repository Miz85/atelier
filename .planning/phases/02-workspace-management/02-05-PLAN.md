---
phase: 02-workspace-management
plan: 05
type: execute
wave: 4
depends_on: ["02-04"]
files_modified:
  - src/app.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to create workspace screen"
    - "User can navigate to workspace list screen"
    - "User can create workspace and see it in list"
    - "User can delete workspace and see it removed"
    - "User can switch between workspaces"
  artifacts:
    - path: "src/app.tsx"
      provides: "Updated app with workspace screens"
      contains: "CreateWorkspace"
  key_links:
    - from: "src/app.tsx"
      to: "src/components/CreateWorkspace.tsx"
      via: "import and render"
      pattern: "import.*CreateWorkspace"
    - from: "src/app.tsx"
      to: "src/components/WorkspaceList.tsx"
      via: "import and render"
      pattern: "import.*WorkspaceList"
---

<objective>
Integrate workspace UI components into the app and verify full workspace lifecycle.

Purpose: Connect all Phase 2 work into a usable feature. User should be able to create, list, select, and delete workspaces through the TUI.

Output: Updated src/app.tsx with workspace screen routing and human verification of full flow
</objective>

<execution_context>
@/Users/nazim.saouli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nazim.saouli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-04-SUMMARY.md
@.planning/phases/02-workspace-management/02-04-SUMMARY.md
@src/app.tsx
@src/components/CreateWorkspace.tsx
@src/components/WorkspaceList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update app.tsx with workspace screens</name>
  <files>src/app.tsx</files>
  <action>
Update `src/app.tsx` to add workspace screens:

**Add imports:**
```typescript
import { CreateWorkspace } from './components/CreateWorkspace.js';
import { WorkspaceList } from './components/WorkspaceList.js';
import { activeWorkspaceAtom, repoPathAtom } from './state/workspace.js';
```

**Update Screen type:**
```typescript
type Screen = 'main' | 'settings' | 'create-workspace' | 'workspace-list';
```

**Add state for active workspace in AppContent:**
```typescript
const [activeWorkspace] = useAtom(activeWorkspaceAtom);
const [repoPath] = useAtom(repoPathAtom);
```

**Add keyboard shortcuts in main screen useInput:**
```typescript
// In the useInput handler, add:
if (input === 'n') {
  setScreen('create-workspace');
}
if (input === 'w') {
  setScreen('workspace-list');
}
```

**Add screen rendering:**
```typescript
if (screen === 'create-workspace') {
  return <CreateWorkspace onBack={() => setScreen('main')} />;
}

if (screen === 'workspace-list') {
  return <WorkspaceList onBack={() => setScreen('main')} />;
}
```

**Update main screen display:**
Replace the existing workspace display section with:
```typescript
<Box marginBottom={1} flexDirection="column">
  <Text>Workspaces: {workspaces.length}</Text>
  {activeWorkspace ? (
    <Text color="green">Active: {activeWorkspace.name} ({activeWorkspace.branch})</Text>
  ) : (
    <Text color="yellow">No active workspace</Text>
  )}
  <Text>Default Agent: {settings.defaultAgent}</Text>
  <Text>IDE: {settings.ideCommand}</Text>
  {repoPath && <Text color="gray">Repo: {repoPath}</Text>}
</Box>
```

**Update help text:**
```typescript
<Box marginTop={1} flexDirection="column">
  <Text color="gray">n: new workspace | w: list workspaces | s: settings | q: quit</Text>
</Box>
```

Remove the old "No workspaces yet" message with Phase 2 placeholder.
  </action>
  <verify>
`npm run build` succeeds with no TypeScript errors.
`npm run start` launches the app.
  </verify>
  <done>
app.tsx updated with:
- CreateWorkspace and WorkspaceList screen routing
- 'n' shortcut for new workspace
- 'w' shortcut for workspace list
- Active workspace display on main screen
- Repository path display
  </done>
</task>

<task type="auto">
  <name>Task 2: Run all unit tests</name>
  <files></files>
  <action>
Run all test scripts to verify the full system works:

```bash
npm run build
npm run test:config
npm run test:state
npm run test:worktree
npm run test:workspace-manager
```

All tests should pass. If any fail, investigate and fix before proceeding to human verification.
  </action>
  <verify>
All four test commands output success messages.
  </verify>
  <done>
All test scripts pass:
- test:config verifies configuration persistence
- test:state verifies Jotai state atoms
- test:worktree verifies git worktree operations
- test:workspace-manager verifies workspace lifecycle
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete workspace management feature:
- Create workspace (git worktree + state)
- List workspaces with navigation
- Select/activate workspace
- Delete workspace (removes worktree + state)
- Active workspace persistence
  </what-built>
  <how-to-verify>
1. Start the app: `npm run build && npm run start`

2. Press 'n' to create a new workspace:
   - Enter a valid git repository path (one you have locally)
   - Enter a branch name like "feature/test-workspace"
   - Workspace should be created (you'll see "Creating workspace..." then return to main)

3. Verify workspace was created:
   - Main screen should show "Active: feature/test-workspace"
   - Press 'w' to see workspace list
   - Your workspace should appear in the list

4. Verify git worktree was created:
   - In a separate terminal: `git worktree list` in your repo
   - Should show the new worktree

5. Test workspace list features:
   - Press 'w' to open list
   - Use j/k to navigate
   - Press Enter to select (sets active)
   - Press Esc to go back

6. Test delete (create a second workspace first if you want to keep one):
   - Press 'w', navigate to workspace
   - Press 'd' once (should show "Press 'd' again to delete")
   - Press 'd' again to confirm
   - Workspace should disappear from list

7. Verify git worktree was removed:
   - `git worktree list` should no longer show deleted workspace

8. Restart app and verify persistence:
   - Quit with 'q'
   - Run `npm run start` again
   - Active workspace should still be set
   - Workspace list should show same workspaces

Expected results:
- All navigation works (n, w, s, q, Esc)
- Workspaces create and delete properly
- Git worktrees are created/removed
- State persists across restarts
  </how-to-verify>
  <resume-signal>Type "approved" if all features work, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` compiles without errors
2. All test scripts pass
3. Human verifies full workspace lifecycle works
4. Git worktrees are created and removed correctly
5. State persists across app restarts
</verification>

<success_criteria>
Phase 2 success criteria from ROADMAP verified:
1. User can create workspace with branch name (creates git worktree)
2. User can delete workspace (removes worktree, kills agent process)
3. User can list all workspaces showing repo and branch info
4. User can switch between workspaces
5. Git worktree state stays synchronized with app state
</success_criteria>

<output>
After completion, create `.planning/phases/02-workspace-management/02-05-SUMMARY.md`
</output>
