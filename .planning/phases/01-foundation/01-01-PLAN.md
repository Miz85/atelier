---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/config/schema.ts
  - src/config/store.ts
autonomous: true

must_haves:
  truths:
    - "Config schema defines ideCommand and defaultAgent with correct types"
    - "Config store provides typed get/set functions for settings"
    - "Config persists to XDG-compliant location"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "conf"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
      contains: "compilerOptions"
    - path: "src/config/schema.ts"
      provides: "Configuration types"
      exports: ["EquipeConfig"]
    - path: "src/config/store.ts"
      provides: "Configuration access"
      exports: ["config", "getIdeCommand", "setIdeCommand", "getDefaultAgent", "setDefaultAgent"]
  key_links:
    - from: "src/config/store.ts"
      to: "conf"
      via: "new Conf() instantiation"
      pattern: "new Conf"
---

<objective>
Set up TypeScript project and implement configuration system using conf package for user settings (IDE command, default agent).

Purpose: Provides the foundation for all other code and enables requirements CONF-01 and CONF-02.
Output: Working TypeScript project with typed configuration storage.
</objective>

<execution_context>
@/Users/nazim.saouli/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nazim.saouli/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize TypeScript project with dependencies</name>
  <files>package.json, tsconfig.json</files>
  <action>
Initialize npm project and install all dependencies from research:

```bash
npm init -y
npm install node-pty@^1.1.0 ink@^5.0.0 react@^19.0.0 jotai@latest conf@^12.0.0 write-file-atomic@^5.0.0 terminate@^2.8.0
npm install --save-dev typescript @types/node @types/react @types/write-file-atomic
```

Update package.json:
- Set "name": "equipe"
- Set "type": "module" (ESM)
- Set "main": "dist/index.js"
- Add "scripts": { "build": "tsc", "dev": "tsc --watch" }

Create tsconfig.json with:
- "target": "ES2022"
- "module": "NodeNext"
- "moduleResolution": "NodeNext"
- "strict": true
- "outDir": "dist"
- "rootDir": "src"
- "jsx": "react-jsx"
- "jsxImportSource": "react" (for Ink/React 19)
- "esModuleInterop": true
- "skipLibCheck": true
  </action>
  <verify>
Run `npm run build` - should succeed (empty build, no src yet).
Run `node -e "require('conf')"` - should not error (package installed).
  </verify>
  <done>
package.json exists with all dependencies, tsconfig.json exists with correct settings, npm run build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create configuration schema and store</name>
  <files>src/config/schema.ts, src/config/store.ts</files>
  <action>
Create src/config/schema.ts with TypeScript interface:

```typescript
export interface EquipeConfig {
  ideCommand: string;      // Command to open IDE (default: 'code')
  defaultAgent: 'claude' | 'opencode';  // Default coding agent
  // Future: workspaces will be stored separately via Jotai persistence
}

export const configDefaults: EquipeConfig = {
  ideCommand: 'code',
  defaultAgent: 'claude',
};
```

Create src/config/store.ts using conf package:

```typescript
import Conf from 'conf';
import { EquipeConfig, configDefaults } from './schema.js';

const schema = {
  ideCommand: {
    type: 'string' as const,
    default: configDefaults.ideCommand,
  },
  defaultAgent: {
    type: 'string' as const,
    enum: ['claude', 'opencode'],
    default: configDefaults.defaultAgent,
  },
};

export const config = new Conf<EquipeConfig>({
  projectName: 'equipe',
  schema,
  // XDG-compliant by default: ~/.config/equipe on Linux, ~/Library/Preferences on macOS
});

// Typed accessors for CONF-01
export function getIdeCommand(): string {
  return config.get('ideCommand');
}

export function setIdeCommand(command: string): void {
  config.set('ideCommand', command);
}

// Typed accessors for CONF-02
export function getDefaultAgent(): 'claude' | 'opencode' {
  return config.get('defaultAgent');
}

export function setDefaultAgent(agent: 'claude' | 'opencode'): void {
  config.set('defaultAgent', agent);
}

// Bulk access
export function getConfig(): EquipeConfig {
  return config.store;
}
```

Note: Use .js extension in imports for ESM compatibility even though source is .ts.
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Run `node dist/config/store.js` - should not error (module loads).
Verify config file created at platform-appropriate location.
  </verify>
  <done>
src/config/schema.ts exports EquipeConfig type and defaults.
src/config/store.ts exports config instance and typed get/set functions.
TypeScript compiles successfully.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add test script to verify configuration works</name>
  <files>src/config/test-config.ts</files>
  <action>
Create a simple test script to verify the config system works end-to-end:

```typescript
// src/config/test-config.ts
// Temporary test script - can be removed after verification

import { config, getIdeCommand, setIdeCommand, getDefaultAgent, setDefaultAgent, getConfig } from './store.js';

console.log('=== Configuration Test ===\n');

// Show config file location
console.log('Config location:', config.path);

// Test defaults
console.log('\n--- Defaults ---');
console.log('IDE command:', getIdeCommand());
console.log('Default agent:', getDefaultAgent());

// Test setters
console.log('\n--- Setting values ---');
setIdeCommand('cursor');
setDefaultAgent('opencode');
console.log('IDE command (after set):', getIdeCommand());
console.log('Default agent (after set):', getDefaultAgent());

// Test bulk access
console.log('\n--- Full config ---');
console.log(JSON.stringify(getConfig(), null, 2));

// Reset to defaults for clean state
setIdeCommand('code');
setDefaultAgent('claude');
console.log('\n--- Reset to defaults ---');
console.log(JSON.stringify(getConfig(), null, 2));

console.log('\n=== Test Complete ===');
```

Add to package.json scripts: "test:config": "node dist/config/test-config.js"
  </action>
  <verify>
Run `npm run build && npm run test:config`
Output should show:
- Config location (platform-specific path)
- Default values (code, claude)
- Changed values (cursor, opencode)
- Reset values (code, claude)
  </verify>
  <done>
Test script runs successfully, config values persist and can be read/written.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no errors
2. `npm run test:config` runs and shows correct output
3. Config file exists at platform location after running test
4. Stopping and re-running test shows persisted values
</verification>

<success_criteria>
- TypeScript project compiles successfully
- conf package installed and configured
- Configuration schema defines ideCommand and defaultAgent
- get/set functions provide typed access to settings
- Settings persist to disk across process restarts
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
